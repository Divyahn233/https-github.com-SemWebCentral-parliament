# Parliament is licensed under the BSD License from the Open Source
# Initiative, http://www.opensource.org/licenses/bsd-license.php
#
# Copyright (c) 2001-2009, BBN Technologies, Inc.
# All rights reserved.

import common ;
import testing ;

project /KB/Test ;

path-constant TestDir : . ;
path-constant KbCoreDir : ../KbCore ;

explicit ParliamentTest ;
run [ glob *.cpp : UnicodeTestCaseGen.cpp ]
		[ glob $(KbCoreDir)/*.cpp : $(KbCoreDir)/*JNI*.cpp $(KbCoreDir)/DllMain.cpp $(KbCoreDir)/Utf8StaticInitGen.cpp ]
		/site-config//BerkeleyDB
		/site-config//BoostHeaderOnlyLibraries
		/site-config//BoostAtomic/<link>static
		/site-config//BoostChrono/<link>static
		/site-config//BoostDateTime/<link>static
		/site-config//BoostFileSystem/<link>static
		/site-config//BoostLog/<link>static
		/site-config//BoostLogSetup/<link>static
		/site-config//BoostRegex/<link>static
		/site-config//BoostSystem/<link>static
		/site-config//BoostThread/<link>static
		/site-config//BoostUnitTest/<link>static
	:	# arguments
		#--list_content
		#--run_test=KbInstanceTestSuite/testByQuickOverview
	:	# input files
	:	<include>.
		<include>$(KbCoreDir)
		<define>PARLIAMENT_SUPPRESS_EXPORTS
		<define>PARLIAMENT_UNIT_TEST
		<threading>multi
		<dependency>ParliamentConfig.txt
		<dependency>$(TestDir)/ParliamentConfig.txt
		#<testing.launcher>TestLauncher.bat
		<target-os>darwin:<cxxflags>"-fvisibility=hidden"
	:	ParliamentTest
	:	# default build
	;

#explicit ParliamentTestOld ;
unit-test ParliamentTestOld
	:	[ glob *.cpp : UnicodeTestCaseGen.cpp ]
		[ glob $(KbCoreDir)/*.cpp : $(KbCoreDir)/*JNI*.cpp $(KbCoreDir)/DllMain.cpp $(KbCoreDir)/Utf8StaticInitGen.cpp ]
		/site-config//BerkeleyDB
		/site-config//BoostHeaderOnlyLibraries
		/site-config//BoostAtomic/<link>static
		/site-config//BoostChrono/<link>static
		/site-config//BoostDateTime/<link>static
		/site-config//BoostFileSystem/<link>static
		/site-config//BoostLog/<link>static
		/site-config//BoostLogSetup/<link>static
		/site-config//BoostRegex/<link>static
		/site-config//BoostSystem/<link>static
		/site-config//BoostThread/<link>static
		/site-config//BoostUnitTest/<link>static
	:	<include>.
		<include>$(KbCoreDir)
		<define>PARLIAMENT_SUPPRESS_EXPORTS
		<define>PARLIAMENT_UNIT_TEST
		<threading>multi
		<dependency>ParliamentConfig.txt
		<dependency>$(TestDir)/ParliamentConfig.txt
		#<testing.launcher>TestLauncher.bat
	:	# default build
	:	# usage requirements
	;

# This one is for Windows:
explicit ParliamentConfig.txt ;
make ParliamentConfig.txt
	: $(KbCoreDir)/ParliamentConfig.txt
	: @common.copy
	: <relevant>toolset <relevant>variant <relevant>address-model <relevant>threading
	;

# And this one is for UNIX-like platforms:
explicit $(TestDir)/ParliamentConfig.txt ;
make $(TestDir)/ParliamentConfig.txt : $(KbCoreDir)/ParliamentConfig.txt : @common.copy ;

exe UnicodeTestCaseGen
	:	UnicodeTestCaseGen.cpp
	:	<include>.
		<threading>multi
		<os>NT:<build>yes
	:	<build>no
	;
